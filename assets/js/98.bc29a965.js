(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{446:function(v,_,e){"use strict";e.r(_);var t=e(2),o=Object(t.a)({},function(){var v=this,_=v.$createElement,e=v._self._c||_;return e("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[e("h1",{attrs:{id:"回流和重绘"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#回流和重绘","aria-hidden":"true"}},[v._v("#")]),v._v(" 回流和重绘")]),v._v(" "),e("p",[v._v("整个在浏览器的渲染过程中回流（Reflow）和重绘（Repaint）会大大影响 Web 性能，尤其是手机页面。因此我们在页面设计的时候要尽量减少回流和重绘。")]),v._v(" "),e("p",[v._v("渲染过程包括页面初始化、用户行为改变界面样式和动画改变界面样式等。")]),v._v(" "),e("h2",{attrs:{id:"回流"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#回流","aria-hidden":"true"}},[v._v("#")]),v._v(" 回流")]),v._v(" "),e("p",[v._v("回流（Reflow），也叫重排，会计算页面布局（Layout）。某个节点回流时会"),e("strong",[v._v("重新计算节点的尺寸和位置")]),v._v("，而且还有可能触及其后代节点的回流。回流后，浏览器会重新绘制受影响的部分到屏幕可视区域，该过程称为重绘。另外，DOM 变化不一定都会影响几何属性，比如改变一个元素的背景色不影响宽高，这种情况下只会发生重绘，代价较小。")]),v._v(" "),e("p",[v._v("当 DOM 的变化影响了元素的几何属性（宽或高），浏览器需要重新计算元素的几何属性，由于流式布局其他元素的几何属性和位置也受到影响。浏览器会使渲染树中受到影响的部分失效，并重新构造渲染树。")]),v._v(" "),e("p",[v._v("回流会从根节点开始递归往下，依次计算所有的结点几何尺寸和位置，在回流过程中，可能会增加一些渲染器，如文本字符串。DOM 树里的每个节点都会有 "),e("code",[v._v("reflow")]),v._v(" 方法，一个结点的回流很有可能导致子节点，甚至父节点以及同级节点的回流。")]),v._v(" "),e("p",[v._v("回流（Reflow）几乎是无法避免的。现在界面上流行的一些效果，比如树状目录的折叠、展开（实质上是元素的显示与隐藏）等，都将引起浏览器的 "),e("code",[v._v("reflow")]),v._v("。鼠标滑过、点击等用户交互事件，只要这些行为引起了页面上某些元素的占位面积、定位方式、边距等属性的变化，都会引起它内部、周围甚至整个页面的重新渲 染。通常我们都无法预估浏览器到底会 "),e("code",[v._v("reflow")]),v._v(" 哪一部分的代码，它们都彼此相互影响着。")]),v._v(" "),e("p",[e("strong",[v._v("回流的原因：")])]),v._v(" "),e("ul",[e("li",[e("strong",[v._v("Initial")]),v._v("：网页初始化的时候")]),v._v(" "),e("li",[e("strong",[v._v("Incremental")]),v._v("：JavaScript 在操作 DOM Tree 时")]),v._v(" "),e("li",[e("strong",[v._v("Resize")]),v._v("：某些元件的尺寸变了")]),v._v(" "),e("li",[e("strong",[v._v("StyleChange")]),v._v("：如果 CSS 的属性发生变化了")]),v._v(" "),e("li",[e("strong",[v._v("Dirty")]),v._v("：几个 Incremental 的 Reflow 发生在同一个元素的子树上")])]),v._v(" "),e("p",[e("strong",[v._v("会导致产生回流的场景：")])]),v._v(" "),e("ul",[e("li",[v._v("网页初始化")]),v._v(" "),e("li",[v._v("元素内容变化，如输入空间")]),v._v(" "),e("li",[v._v("脚本操作 DOM（增加、删除和修改）")]),v._v(" "),e("li",[v._v("计算 "),e("code",[v._v("offsetWidth")]),v._v(" 和 "),e("code",[v._v("offsetHeight")]),v._v(" 等")]),v._v(" "),e("li",[v._v("改变浏览器窗口大小")]),v._v(" "),e("li",[v._v("设置 style 属性")]),v._v(" "),e("li",[v._v("操作 class 属性")]),v._v(" "),e("li",[v._v("激活伪类，如 "),e("code",[v._v(":hover")])]),v._v(" "),e("li",[v._v("改变文字大小")]),v._v(" "),e("li",[v._v("样式表变动")])]),v._v(" "),e("p",[v._v("浏览器并不会在我们进行上述操作时立即进行回流，浏览器会积攥一批 Reflow 后批量进行回流，不过有的操作会让浏览器立马进行回流，比如窗口缩放，改变了页面默认的字体，或者说获取以下这些值。")]),v._v(" "),e("ul",[e("li",[e("code",[v._v("offsetTop")]),v._v("、"),e("code",[v._v("offsetLeft")]),v._v("、"),e("code",[v._v("offsetWidth")]),v._v("、"),e("code",[v._v("offsetHeight")])]),v._v(" "),e("li",[e("code",[v._v("scrollTop")]),v._v("、"),e("code",[v._v("scrollLeft")]),v._v("、"),e("code",[v._v("scrollWidth")]),v._v("、"),e("code",[v._v("scrollHeight")])]),v._v(" "),e("li",[e("code",[v._v("clientTop")]),v._v("、"),e("code",[v._v("clientLeft")]),v._v("、"),e("code",[v._v("clientWidth")]),v._v("、"),e("code",[v._v("clientHeight")])]),v._v(" "),e("li",[v._v("IE 中的 "),e("code",[v._v("getComputedStyle()")]),v._v(" 和 "),e("code",[v._v("currentStyle")])])]),v._v(" "),e("p",[e("strong",[v._v("减少回流的方案：")])]),v._v(" "),e("ul",[e("li",[v._v("不要通过父级来改变子元素样式，最好直接改变子元素样式，改变子元素样式尽可能不要影响父元素和兄弟元素的大小和尺寸")]),v._v(" "),e("li",[v._v("尽量通过 "),e("code",[v._v("class")]),v._v(" 来设计元素样式，切忌使用 "),e("code",[v._v("style")])]),v._v(" "),e("li",[v._v("实现元素的动画，对于经常要进行回流的组件，要抽离出来，它的 "),e("code",[v._v("position")]),v._v(" 属性应当设为 "),e("code",[v._v("fixed")]),v._v(" 或 "),e("code",[v._v("absolute")])]),v._v(" "),e("li",[v._v("权衡速度的平滑。比如实现一个动画，以 1 个像素为单位移动这样最平滑，但回流就会过于频繁，CPU 很快就会被完全占用。如果以 3 个像素为单位移动就会好很多。")]),v._v(" "),e("li",[v._v("不要用 "),e("code",[v._v("table")]),v._v(" 布局的另一个原因就是 "),e("code",[v._v("tables")]),v._v(" 中某个元素一旦触发回流就会导致 "),e("code",[v._v("table")]),v._v(" 里所有的其它元素回流。在适合用 "),e("code",[v._v("table")]),v._v(" 的场合，可以设置 "),e("code",[v._v("table-layout")]),v._v(" 为 "),e("code",[v._v("auto")]),v._v(" 或 "),e("code",[v._v("fixed")]),v._v("。")]),v._v(" "),e("li",[v._v("CSS 里不要有表达式")]),v._v(" "),e("li",[v._v("减少不必要的 DOM 层级。改变 DOM 树中的一级会导致所有层级的改变，上至根部，下至被改变节点的子节点。这导致大量时间耗费在执行回流上面。")]),v._v(" "),e("li",[v._v("避免不必要的复杂的 CSS 选择器，尤其是后代选择器，因为为了匹配选择器将耗费更多的 CPU。")]),v._v(" "),e("li",[v._v("尽量不要过多的频繁的去增加、修改或删除元素，因为这可能会频繁地导致页面回流，可以先把该 DOM 节点抽离道内存中进行复杂的操作然后再 "),e("code",[v._v("display")]),v._v(" 到页面上。")]),v._v(" "),e("li",[v._v("不要逐条地修改 DOM 样式。与其这样，不如预先定义好 CSS 的 "),e("code",[v._v("class")]),v._v("，然后修改 DOM 的 "),e("code",[v._v("className")]),v._v("。")])]),v._v(" "),e("h2",{attrs:{id:"重绘"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重绘","aria-hidden":"true"}},[v._v("#")]),v._v(" 重绘")]),v._v(" "),e("p",[v._v("重绘（Repaint）遍历所有节点，"),e("strong",[v._v("检测节点的可见性、颜色、轮廓等可见的样式属性")]),v._v("，然后根据检测的结果更新页面的响应部分。当渲染树中的一些元素需要更新一些不会改变元素布局的属性，比如只是影响元素的外观、风格、而不会影响布局的那些属性，这时候就只发生重绘。当然，页面首次加载也是要重绘一次的。")]),v._v(" "),e("p",[v._v("光栅：光栅主要是针对图形的一个栅格化过程。现代浏览器中主要的绘制工作主要用光栅化软件来完成。所以元素重绘由这个元素和绘制层级的关系，来决定的是否会很大程度影响你的性能-，如果这个元素盖住的多层元素都被重新绘制，性能损耗当然大。")]),v._v(" "),e("h2",{attrs:{id:"动态变化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#动态变化","aria-hidden":"true"}},[v._v("#")]),v._v(" 动态变化")]),v._v(" "),e("p",[v._v("在网页元素发生变化时，浏览器会尽可能做出最小的响应：")]),v._v(" "),e("ul",[e("li",[v._v("元素颜色的改变：只会对该元素进行"),e("strong",[v._v("重绘")]),v._v("。")]),v._v(" "),e("li",[v._v("元素位置的改变：只会对该元素及其子元素（可能还有同级元素）进行"),e("strong",[v._v("布局和重绘")]),v._v("。")]),v._v(" "),e("li",[v._v("添加 DOM 节点：会对该节点进行"),e("strong",[v._v("布局和重绘")]),v._v("。")]),v._v(" "),e("li",[v._v("一些重大变化（例如增大 "),e("code",[v._v("<html>")]),v._v(" 元素的字体）会导致缓存无效，使得整个渲染树都会进行重新"),e("strong",[v._v("布局")]),v._v("和"),e("strong",[v._v("绘制")]),v._v("。")])]),v._v(" "),e("hr"),v._v(" "),e("p",[e("strong",[v._v("参考资料：")])]),v._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://segmentfault.com/a/1190000015851927",target:"_blank",rel:"noopener noreferrer"}},[v._v("📝 学习重流和重绘（reflow 和 repaint）"),e("OutboundLink")],1)]),v._v(" "),e("li",[e("a",{attrs:{href:"https://segmentfault.com/a/1190000016056546",target:"_blank",rel:"noopener noreferrer"}},[v._v("📝 研讨浏览器绘制和 Web 性能的注意事项"),e("OutboundLink")],1)])])])},[],!1,null,null,null);_.default=o.exports}}]);